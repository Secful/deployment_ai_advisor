# Customer Session Storage

## Overview
This directory contains customer-specific deployment advisor sessions with complete conversation history, deployment context, and generated documentation. Sessions are organized by API key and version number for complete traceability and learning.

## Directory Structure

### Customer-Specific Sessions
```
sessions/
├── [api_key]/
│   ├── v1.0.0/
│   │   ├── conversation.json
│   │   ├── deployment_context.json
│   │   ├── session_metadata.json
│   │   ├── sow_document.md
│   │   └── session_analytics.json
│   ├── v1.0.1/
│   └── v2.0.0/
└── README.md
```

### File Specifications

#### conversation.json
Complete conversation transcript with turn-by-turn interaction history:
```json
{
  "session_id": "orchestrator-session-{uuid}",
  "conversation_turns": [
    {
      "turn_id": 1,
      "timestamp": "2025-01-15T10:30:00Z",
      "user_input": {
        "query": "What collector should I use for my AWS API Gateway?",
        "command": null,
        "parameters": {}
      },
      "agent_response": {
        "orchestrator_response": "...",
        "sub_agents_invoked": ["deployment-advisor"],
        "processing_time_seconds": 23.5,
        "confidence_score": 8
      },
      "decision_points": [
        {
          "decision": "cloud_provider_identification",
          "value": "aws",
          "confidence": 0.95
        }
      ]
    }
  ],
  "conversation_summary": {
    "total_turns": 5,
    "total_duration_minutes": 12,
    "primary_cloud_provider": "aws",
    "services_discussed": ["api-gateway", "lambda", "cloudwatch"],
    "final_recommendation": "AWS API Gateway Enhanced Collector"
  }
}
```

#### deployment_context.json
Comprehensive deployment and architecture context:
```json
{
  "cloud_assets_snapshot": {
    "timestamp": "2025-01-15T10:30:00Z",
    "assets": [
      {
        "id": "api-gw-12345",
        "type": "api_gateway",
        "provider": "aws",
        "configuration": {
          "name": "production-api",
          "stage": "v1",
          "integration_type": "lambda"
        }
      }
    ]
  },
  "deployment_recommendations": [
    {
      "collector_type": "AWS API Gateway Enhanced Collector",
      "complexity_score": 5,
      "confidence_level": 8,
      "success_probability": 0.92,
      "prerequisites": ["cloudwatch_role", "log_group_permissions"],
      "implementation_steps": ["..."]
    }
  ],
  "validation_results": {
    "validation_performed": true,
    "overall_status": "PARTIAL_SUCCESS",
    "completion_percentage": 85,
    "gaps_identified": ["missing_log_group", "incomplete_permissions"]
  },
  "error_resolutions": [
    {
      "error_description": "Permission denied accessing CloudWatch",
      "resolution_applied": "Updated IAM role permissions",
      "success": true,
      "resolution_time_minutes": 15
    }
  ]
}
```

#### session_metadata.json
Session metadata and analytics:
```json
{
  "session_info": {
    "session_id": "orchestrator-session-{uuid}",
    "api_key": "customer-xyz789",
    "session_version": "v1.0.0",
    "created_timestamp": "2025-01-15T10:30:00Z",
    "completed_timestamp": "2025-01-15T10:42:00Z",
    "session_duration_minutes": 12
  },
  "workflow_tracking": {
    "workflow_type": "deployment_guidance",
    "completion_status": "completed",
    "user_satisfaction_indicators": {
      "explicit_positive_feedback": true,
      "completed_to_implementation": true,
      "follow_up_questions_answered": 3
    },
    "escalation_events": []
  },
  "agent_performance": {
    "orchestrator_invocations": 5,
    "sub_agent_invocations": {
      "deployment-advisor": 2,
      "data-extractor": 3,
      "validator": 1,
      "reporter": 1
    },
    "total_processing_time_seconds": 145,
    "average_response_time_seconds": 23.2
  },
  "quality_metrics": {
    "recommendation_confidence_average": 8.2,
    "user_query_complexity_average": 6.5,
    "session_success_score": 9.1
  }
}
```

#### sow_document.md
Generated Statement of Work document (if created during session):
```markdown
# Deployment Statement of Work

**Document Version**: 1.0
**Created**: 2025-01-15T10:40:00Z
**Customer**: Customer XYZ
**Session ID**: orchestrator-session-{uuid}

[Complete SOW content as generated by reporter agent...]
```

#### session_analytics.json
Detailed analytics and learning data:
```json
{
  "complexity_analysis": {
    "deployment_complexity_score": 5,
    "architecture_complexity": 4,
    "user_expertise_inferred": "intermediate",
    "question_complexity_average": 6.2
  },
  "prediction_accuracy": {
    "estimated_time_hours": 3.5,
    "actual_time_hours": null,
    "estimated_success_probability": 0.92,
    "actual_success": null,
    "confidence_calibration": 8.2
  },
  "learning_insights": {
    "successful_patterns": [
      "AWS API Gateway with Lambda integration",
      "Intermediate user with clear requirements"
    ],
    "challenge_areas": [
      "IAM permission configuration complexity"
    ],
    "recommendation_effectiveness": {
      "primary_recommendation_accepted": true,
      "alternative_options_considered": false
    }
  },
  "similarity_vectors": {
    "architecture_pattern_hash": "aws-api-gateway-lambda-v1",
    "user_interaction_pattern": "direct-questions-technical-focus",
    "complexity_profile": "intermediate-standard-deployment"
  }
}
```

## Session Versioning

### Version Format
Sessions use semantic versioning: `v{major}.{minor}.{patch}`

- **Major**: New session with same customer (different deployment scenario)
- **Minor**: Continuation of same session (follow-up conversations)
- **Patch**: Corrections or updates to existing session data

### Version Management
```json
{
  "versioning_rules": {
    "new_deployment_scenario": "increment_major",
    "follow_up_conversation": "increment_minor",
    "data_correction": "increment_patch"
  },
  "conflict_resolution": {
    "concurrent_sessions": "timestamp_based_ordering",
    "session_merge": "manual_review_required"
  }
}
```

## Data Privacy and Security

### Customer Data Protection
- All customer-specific data remains in customer-specific directories
- No cross-customer data sharing or access
- Complete session context preserved for customer benefit
- Audit trail maintained for all data access

### Data Retention
```json
{
  "retention_policies": {
    "active_customer_sessions": "indefinite_retention",
    "completed_sessions": "2_year_retention",
    "error_logs": "1_year_retention",
    "analytics_summaries": "5_year_retention"
  }
}
```

## Usage Patterns

### Session Creation
Sessions are automatically created by the reporter agent during conversations:
1. **Session Initialization**: Created on first user interaction
2. **Real-time Updates**: Updated during conversation progression
3. **Session Completion**: Finalized when conversation concludes
4. **Post-processing**: Analytics and learning data extracted

### Session Retrieval
Sessions can be retrieved for:
- **Customer Context**: Loading previous conversation context
- **Follow-up Sessions**: Building on previous deployments
- **Support Escalation**: Providing complete context to human experts
- **Success Tracking**: Monitoring deployment outcomes

### Learning Integration
Customer sessions contribute to system learning through:
- **Pattern Analysis**: Identifying successful deployment patterns
- **Recommendation Refinement**: Improving recommendation accuracy
- **Error Prevention**: Learning from troubleshooting scenarios
- **User Experience**: Understanding user interaction patterns

## Quality Assurance

### Data Integrity
- **JSON Schema Validation**: All JSON files validated against schemas
- **Referential Integrity**: Cross-file references validated
- **Timestamp Consistency**: Chronological consistency verified
- **Data Completeness**: Required fields presence validated

### Session Health Monitoring
```json
{
  "health_checks": {
    "session_completeness": "verify_all_files_present",
    "data_consistency": "cross_validate_references",
    "storage_integrity": "checksum_verification",
    "access_permissions": "verify_customer_isolation"
  }
}
```

## Integration with System Components

### Reporter Agent Integration
- **Real-time Session Tracking**: Updates session files during conversation
- **Document Generation**: Creates SOW and other documents in session
- **Metadata Management**: Maintains session metadata and analytics

### Data Extractor Integration
- **Historical Context**: Provides previous session data for context
- **Pattern Matching**: Uses session data for similarity analysis
- **Learning Enhancement**: Contributes session insights to recommendations

### Orchestrator Integration
- **Session Context**: Provides conversation context for continuity
- **Performance Tracking**: Records orchestrator and sub-agent performance
- **Quality Metrics**: Tracks recommendation quality and user satisfaction

## Performance Considerations

### Storage Optimization
- **JSON Compression**: Large session files compressed for storage
- **Incremental Updates**: Only changed data written to disk
- **Index Maintenance**: Search indexes updated for fast retrieval

### Access Performance
- **Caching Strategy**: Frequently accessed sessions cached in memory
- **Lazy Loading**: Large documents loaded only when needed
- **Parallel Access**: Multiple session operations handled concurrently

## Future Enhancements

### Advanced Analytics
- **Deployment Success Correlation**: Track actual deployment outcomes
- **User Journey Analysis**: Analyze complete customer deployment journey
- **Recommendation Evolution**: Track how recommendations improve over time

### Enhanced Integration
- **External System Integration**: Connect with customer deployment systems
- **Automated Follow-up**: Schedule follow-up validation and support
- **Success Notification**: Notify when deployments succeed or need attention